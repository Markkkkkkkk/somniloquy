---
category: [博客建站]
tag: [服务器设置, Fail2ban,网站安全,wordfence]
postType: post
status: publish
---

# 服务器密钥登陆

服务器这里以Ubuntu为例，centos或其他版本的Linux服务器请自行GPT哈。

首先在你的本地window机器 上，进入cmd命令行使用以下命令生成 SSH 密钥对：

```shell
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

这将会生成一个 RSA 类型的密钥对，长度为 4096 位。你可以按提示选择保存密钥的位置和设置密码。默认位置在`C:\Users\你的window账户名\.ssh\id_rsa.pub`然后将生成的密钥文件内容粘贴到服务器`~/.ssh/authorized_keys`这个目录下。然后修改文件权限：

```shell
chmod 700 ~/.ssh  
chmod 600 ~/.ssh/authorized_keys
```

截下来配置SSH 只允许密钥登录，登录到你的 Ubuntu 服务器，编辑 SSH 配置文件：

```shell
sudo nano /etc/ssh/sshd_config
```

找到并修改以下几行（如果没有这些行，手动添加）：

```shell
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM no
```

- PasswordAuthentication no：禁用密码认证

- ChallengeResponseAuthentication no：禁用挑战-响应认证

- UsePAM no：禁用基于 PAM 的认证

修改配置后，重启 SSH 服务使更改生效：

```
sudo systemctl restart ssh
```

在本地window电脑上你可以尝试用SSH工具密码登录服务器，提示是被拒绝的，登录方式选择密钥登录则是可以的，密钥文件在你本地电脑的`C:\Users\你的window账户名\.ssh\id_rsa`文件内，这样很大程度上能防止别人密码爆破。

# Fail2ban设置

Fail2Ban 是一种用于 Linux 系统的安全工具，它通过监控系统日志文件来防止暴力破解攻击，并根据特定的规则封禁可疑的 IP 地址。这里还是以Ubuntu为例，首先安装Faile2ban。

```shell
sudo apt update
sudo apt install fail2ban -y
```

启动并设置开机自启

```shell
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

查看状态：

```
sudo systemctl status fail2ban
```

如果显示为active则Fail2ban就安装好了，安装不复杂，接下来主要是配置一些规则

## 防止wordpress登录暴力破解规则

打开`/etc/fail2ban/jail.conf`目录下的这个文件，在空白处添加：

```
[wordpress-auth]
enabled = true
filter = wordpress-auth
port = http,https
# nginx日志位置，根据自己实际目录修改。
logpath = /usr/apps/blog/nginx/logs/access.log
# 失败次数
maxretry = 5
# 在多长时间内失败
findtime = 600
# 在600秒之内失败超过五次则封禁十小时。
bantime = 36000
```

其次在`/etc/fail2ban/filter.d`在这个文件夹下边新建文件`wordpress-auth.conf`，内容为：

```
[Definition]
failregex = ^<HOST> .* "POST /wp-login.php HTTP.*" 200
            ^<HOST> .* "POST /wp-login.php HTTP.*" 403
            # 下边两个因为wordpress使用了WPS隐藏登录插件修改了登录接口，所以修改后的地址也添加进去。
            ^<HOST> .* "POST /iloveyou HTTP.*" 200
            ^<HOST> .* "POST /iloveyou HTTP.*" 403
ignoreregex =

```

他的原理其实就是根据nginx访问日志，统计IP特定URL失败的次数，然后把符合条件的IP添加到封禁列表。这样就能防止别人暴力破解登录后台了。

## 防止XML-RPC 服务暴力破解规则

XML-RPC 是一种用于远程通信的协议，在 WordPress 中用于外部应用程序进行访问和管理。简单来说就是用API接口直接操作wordpress内容，比方说发布增删改查文章等。

打开`/etc/fail2ban/jail.conf`目录下的这个文件，在空白处添加：

```
[wordpress-xmlrpc]
enabled = true
filter = wordpress-xmlrpc
port = http,https
logpath = /usr/apps/blog/nginx/logs/access.log
maxretry = 5
findtime = 600
bantime = 36000
```

其次在`/etc/fail2ban/filter.d`在这个文件夹下边新建文件`wordpress-xmlrpc.conf`，内容为：

```
[Definition]
failregex = ^<HOST> .*POST /xmlrpc.php HTTP.*$
ignoreregex =
```

## 防止服务器SSH暴力破解登录规则

在`/etc/fail2ban/jail.conf`在这个配置文件里找到`[ssh]`这个配置，初始安装的这个配置是自带有的但是还要加一点东西。大家可以根据已有的跟下边的对照一下。这个规则是防止服务器被别人SSH暴力破解的规则。

```
[sshd]
enabled=true
port    = ssh
filter  = sshd
logpath = %(sshd_log)s
backend = %(sshd_backend)s
# 添加的内容
maxretry=5
findtime = 600
bantime=18000
action = %(action_)s
         log-ban-history
```

## 防御扫描型攻击规则

这种规则用来防御“扫描型攻击”。攻击者会不停地访问你站点上并不存在的路径（比如 `/phpmyadmin/、/wp-admin/install.php、/xxx.php`），通过不断试探 404 错误页面来寻找漏洞或敏感文件。Fail2Ban 就会检测到某个 IP 在短时间内制造大量 404，判断它是恶意扫描，从而临时封禁它。

打开`/etc/fail2ban/jail.conf`目录下的这个文件，在空白处添加：

```
[nginx-404]
enabled = true
port = http,https
filter = nginx-404
logpath = /usr/apps/blog/nginx/logs/access.log
maxretry = 10
findtime = 600
bantime = 3600
```

其次在`/etc/fail2ban/filter.d`在这个文件夹下边新建文件`nginx-404.conf`，内容为：

```
[Definition]
failregex = ^<HOST> -.*"(GET|POST).*(HTTP).*" 404
ignoreregex =
```

大家配置好之后别忘了最后再重启下Fail2ban，让规则生效。也可以查看自己哪些规则生效和过一段时间之后查看封禁了哪些IP。

```
# 重启命令
sudo systemctl restart fail2ban
# 查看运行状态
sudo systemctl status fail2ban
# 查看有哪些规则生效
sudo fail2ban-client status
# 查看具体某个规则的状态和对应封禁的IP
sudo fail2ban-client status nginx-404
# 解封某个IP
sudo fail2ban-client set nginx-404 unbanip 192.168.1.100
```

# Wordfence Security

Wordfence 是一个很受欢迎的 WordPress 安全插件，他能保护你的 WordPress 网站免受各种安全威胁，包括 恶意攻击、暴力破解、病毒、木马、SQL 注入等常见攻击。

它提供了 防火墙保护、恶意软件扫描、登录安全、实时流量监控等多种功能，确保网站在面对网络攻击时能够及时阻止。其特点包括实时 IP 封禁、攻击防御、日志记录等。

## 安装

在wordpress插件安装页面直接搜索安装启用就可以了，记得启用自动更新，因为是安全类软件，最好是及时更新比较好。

![image-20220429094431972](https://image.hyly.net/i/2025/08/18/20be19d56de7a932c78d14794869880d-0.webp)

初始化时会要求输入一个邮箱，平时用来发送安全相关信息。填一个常用邮箱即可。

![image-20220429094910185](https://image.hyly.net/i/2025/08/18/090785e175e9b5d402a80e3072c66242-0.webp)

一般插件都会问你要不要购买高级版。我们直接谢谢即可。免费版已经够用，如果不够用了再买也不迟。

![image-20220429095039236](https://image.hyly.net/i/2025/08/18/39c371216be24d28d529225386120964-0.webp)

一般是通过左侧菜单栏进入设置wordfence的：

![image-20220429095254328](https://image.hyly.net/i/2025/08/18/e1fd542c796e6f48ee9f4d246a113365-0.webp)

## 全局选项

全局选项大家可以参考我的配置，可以从这里进入：

![image-20220429095752599](https://image.hyly.net/i/2025/08/18/dcc19c1240c59d50e2af709f63ad40fb-0.webp)

详细的配置如下：

![image-20250818185106784](https://image.hyly.net/i/2025/08/18/38e65ee78e36fce9c870efacd7ac13a7-0.webp)

1. **许可证：**就算是免费版，也是要注册一个账号获取许可证的，然后把许可证密钥填入到对应框就可以了。
2. **当有管理员权限的人登录时提醒我：**这个关掉就可以了，要不然每次登录的时候都会发送一封邮件，挺烦人的，只需要开启**仅在管理员从新设备或位置登录时提醒我**就可以了。

## 防火墙设置

入口从这里进入。

![image-20250818190005387](https://image.hyly.net/i/2025/08/18/1e2b17229990a1571397052e9866a8d2-0.webp)

这是我所有的配置，大家可以参照配置。

1. **强力保护：**这里也针对网站登录做了一定防护，可以与Fail2ban结合增强防护，虽然有些有重复的地方。
2. **限速：**限速这里则对人类和爬虫频繁访问行为做了一定限制。

![image-20250818190404160](https://image.hyly.net/i/2025/08/18/538930e947d8e834fc9e8c1241ed22e3-0.webp)

### 拦截

其中在防火墙设置里能查看被阻止的IP都有哪些，可以根据阻止次数较多的IP手动设置拦截，这样就能永久拦截，不会走默认的规则，默认的规则是一定时间内达到一定访问次数才会阻止一次，算一次。

![image-20250818193716247](https://image.hyly.net/i/2025/08/18/419847ba94dbf94fb6be6e11922ac5fb-0.webp)

可以在拦截这里选择IP地址进行手动拦截。

![image-20250818193821760](https://image.hyly.net/i/2025/08/18/abd05f358157674b779d2b2dc89a1f39-0.webp)

## 扫描

大家可以在这里进入扫描，最初安装的时候可以进行一次扫描，发现wordpress网站的问题，然后根据下边的扫描结果进行相应的修复，因为问题可能多种多样，这里就不一一列举了，不知道如何修复或者要不要修复的小伙伴可以自行GPT解决。

![image-20250818191037308](https://image.hyly.net/i/2025/08/18/f9fe73d7dd2ba84bb6842c1c57532c8c-0.webp)

## 登录安全性

大家可以在登录安全性这里设置双重身份验证，这样大大增强用户登录的安全性，防止别人登录后台暴力破解，但是我嫌麻烦就先没设置，但是登录安全性->设置这里有个reCAPTCHA我觉得还是挺好的，他的原理就是调用谷歌验证码，就是那种需要点击我不是机器人的那种验证码，对用户友好一点。详细的reCAPTCHA密钥获取方法在下边的注意链接里，点进去登录谷歌账号一步步获取就可以了，然后把密钥和Secret填到两个对话框里就可以。

![image-20250818194715731](https://image.hyly.net/i/2025/08/18/75bcd01912cfdc03752f04483a9781e0-0.webp)

设置好之后登陆页面就会出现这个图标，如果reCAPTCHA觉得页面访问的人是人类就不会有验证码，如果是机器人或觉得访问者不安全就会出验证码或直接发送邮件，邮件里有一个登陆链接复制到浏览器再次登录才行，可以说是相当安全的了。reCAPTCHA这里还可以设置阈值分数，一般0.5就可以了。

![image-20250818200208812](https://image.hyly.net/i/2025/08/18/540fd5327907b25d9c26321d16ea57ad-0.webp) 



至此，Wordfence Security就配置完成啦~ 如果遇到紧急问题的话他会自动发邮件提醒的，大家在平时也可以登录博客后台查看日志看有什么问题没。